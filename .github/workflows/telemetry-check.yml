name: ðŸ”­ Telemetry Check

on:
  workflow_call:
    inputs:
      os:
        required: true
        type: string

jobs:
  telemetry-check:
    runs-on: ${{ inputs.os }}

    env:
      REDWOOD_REDIRECT_TELEMETRY: 'http://127.0.0.1:48619' # Random port

    steps:
      - uses: actions/checkout@8e8c483db84b4bee98b60c0593521ed34d9990e8 # v6
      - name: Set up job
        uses: ./.github/actions/set-up-job

      - name: ðŸ“¢ Listen for telemetry (CCDRA)
        run: node ./.github/actions/telemetry_check/check.mjs --mode ccdra

      - name: ðŸ“¢ Listen for telemetry (CLI)
        run: node ./.github/actions/telemetry_check/check.mjs --mode cli
        env:
          YARN_ENABLE_IMMUTABLE_INSTALLS: false
